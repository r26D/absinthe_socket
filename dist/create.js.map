{"version":3,"file":"create.js","sources":["../src/notifier/observer/notifyAll.js","../src/notifier/notify.js","../src/notifier/findIndex.js","../src/notifier/remove.js","../src/updateNotifiers.js","../src/notifier/event/eventNames.js","../src/notifier/event/eventCreators.js","../src/abortNotifier.js","../src/handlePush.js","../src/notifier/notifyActive.js","../src/notifier/notifyResultEvent.js","../src/notifier/notifyStartEvent.js","../src/notifier/find.js","../src/pushAbsintheEvent.js","../src/notifier/refresh.js","../src/refreshNotifier.js","../src/notifier/requestStatuses.js","../src/absinthe-event/absintheEventNames.js","../src/absinthe-event/absintheEventCreators.js","../src/pushRequestUsing.js","../src/notifier/notifyCanceled.js","../src/notifier/flushCanceled.js","../src/notifier/reset.js","../src/subscription.js","../src/pushRequest.js","../src/joinChannel.js","../src/create.js"],"sourcesContent":["// @flow\n\nimport type {Event, Observer} from \"../types\";\n\nconst getNotifier = (handlerName, payload) => observer =>\n  observer[handlerName] && observer[handlerName](payload);\n\nconst getHandlerName = ({name}) => `on${name}`;\n\nconst notifyAll = <Result, Variables: void | Object>(\n  observers: $ReadOnlyArray<Observer<Result, Variables>>,\n  event: Event\n) => observers.forEach(getNotifier(getHandlerName(event), event.payload));\n\nexport default notifyAll;\n","// @flow\n\nimport observerNotifyAll from \"./observer/notifyAll\";\n\nimport type {Event, Notifier} from \"./types\";\n\nconst getObservers = ({activeObservers, canceledObservers}) => [\n  ...activeObservers,\n  ...canceledObservers\n];\n\nconst notify = <Result, Variables: void | Object>(\n  notifier: Notifier<Result, Variables>,\n  event: Event\n) => {\n  observerNotifyAll(getObservers(notifier), event);\n\n  return notifier;\n};\n\nexport default notify;\n","// @flow\n\nimport {hasIn} from \"@jumpn/utils-composite\";\n\nimport type {Notifier} from \"./types\";\n\nconst findIndex = (\n  notifiers: Array<Notifier<any, any>>,\n  key: string,\n  value: any\n) =>\n  // $FlowFixMe: flow is having some troubles to match hasIn signature (curry)\n  notifiers.findIndex(hasIn([key], value));\n\nexport default findIndex;\n","// @flow\n\nimport {remove as arrayRemove} from \"@jumpn/utils-array\";\n\nimport findIndex from \"./findIndex\";\n\nimport type {Notifier} from \"./types\";\n\nconst remove = (notifier: Notifier<any, any>) => (\n  notifiers: Array<Notifier<any, any>>\n) =>\n  arrayRemove(findIndex(notifiers, \"request\", notifier.request), 1, notifiers);\n\nexport default remove;\n","// @flow\n\nimport type {AbsintheSocket} from \"./types\";\nimport type {Notifier} from \"./notifier/types\";\n\ntype Notifiers = Array<Notifier<any, any>>;\n\nconst updateNotifiers = (\n  absintheSocket: AbsintheSocket,\n  updater: (notifiers: Notifiers) => Notifiers\n) => {\n  absintheSocket.notifiers = updater(absintheSocket.notifiers);\n\n  return absintheSocket;\n};\n\nexport default updateNotifiers;\n","// @flow\n\nconst eventNames = {\n  abort: (\"Abort\": \"Abort\"),\n  cancel: (\"Cancel\": \"Cancel\"),\n  error: (\"Error\": \"Error\"),\n  result: (\"Result\": \"Result\"),\n  start: (\"Start\": \"Start\")\n};\n\ntype EventName = $Values<typeof eventNames>;\n\nexport default eventNames;\n\nexport type {EventName};\n","// @flow\n\nimport eventNames from \"./eventNames\";\n\nimport type {\n  AbortEvent,\n  CancelEvent,\n  ErrorEvent,\n  Notifier,\n  ResultEvent,\n  StartEvent\n} from \"../types\";\n\nconst createStartEvent = <Payload: Notifier<any, any>>(\n  payload: Payload\n): StartEvent<Payload> => ({payload, name: eventNames.start});\n\nconst createResultEvent = <Result>(payload: Result): ResultEvent<Result> => ({\n  payload,\n  name: eventNames.result\n});\n\nconst createErrorEvent = (payload: Error): ErrorEvent => ({\n  payload,\n  name: eventNames.error\n});\n\nconst createCancelEvent = (): CancelEvent => ({\n  name: eventNames.cancel,\n  payload: undefined\n});\n\nconst createAbortEvent = (payload: Error): AbortEvent => ({\n  payload,\n  name: eventNames.abort\n});\n\nexport {\n  createStartEvent,\n  createResultEvent,\n  createErrorEvent,\n  createCancelEvent,\n  createAbortEvent\n};\n","// @flow\n\nimport notifierNotify from \"./notifier/notify\";\nimport notifierRemove from \"./notifier/remove\";\nimport updateNotifiers from \"./updateNotifiers\";\nimport {createAbortEvent} from \"./notifier/event/eventCreators\";\n\nimport type {AbsintheSocket} from \"./types\";\nimport type {Notifier} from \"./notifier/types\";\n\nconst abortNotifier = (\n  absintheSocket: AbsintheSocket,\n  notifier: Notifier<any, any>,\n  error: Error\n) =>\n  updateNotifiers(\n    absintheSocket,\n    notifierRemove(notifierNotify(notifier, createAbortEvent(error)))\n  );\n\nexport default abortNotifier;\n","// @flow\n\nimport {Push} from \"phoenix\";\n\nimport type {PushHandler} from \"./types\";\n\nconst handlePush = (push: Push, handler: PushHandler<any>) =>\n  push\n    .receive(\"ok\", handler.onSucceed)\n    .receive(\"error\", handler.onError)\n    .receive(\"timeout\", handler.onTimeout);\n\nexport default handlePush;\n","// @flow\n\nimport observerNotifyAll from \"./observer/notifyAll\";\n\nimport type {Event, Notifier} from \"./types\";\n\nconst notifyActive = <Result, Variables: void | Object>(\n  notifier: Notifier<Result, Variables>,\n  event: Event\n) => {\n  observerNotifyAll(notifier.activeObservers, event);\n\n  return notifier;\n};\n\nexport default notifyActive;\n","// @flow\n\nimport notifyActive from \"./notifyActive\";\nimport {createResultEvent} from \"./event/eventCreators\";\n\nimport type {Notifier} from \"./types\";\n\nconst notifyResultEvent = <Result, Variables: void | Object>(\n  notifier: Notifier<Result, Variables>,\n  result: Result\n) => notifyActive(notifier, createResultEvent(result));\n\nexport default notifyResultEvent;\n","// @flow\n\nimport notifyActive from \"./notifyActive\";\nimport {createStartEvent} from \"./event/eventCreators\";\n\nimport type {Notifier} from \"./types\";\n\nconst notifyStartEvent = <Result, Variables: void | Object>(\n  notifier: Notifier<Result, Variables>\n) => notifyActive(notifier, createStartEvent(notifier));\n\nexport default notifyStartEvent;\n","// @flow\n\nimport {hasIn} from \"@jumpn/utils-composite\";\n\nimport type {Notifier} from \"./types\";\n\nconst find = (notifiers: Array<Notifier<any, any>>, key: string, value: any) =>\n  // $FlowFixMe: flow is having some troubles to match hasIn signature (curry)\n  notifiers.find(hasIn([key], value));\n\nexport default find;\n","// @flow\n\nimport {map} from \"@jumpn/utils-composite\";\n\nimport type {GqlRequest} from \"@jumpn/utils-graphql/compat/cjs/types\";\n\nimport handlePush from \"./handlePush\";\nimport notifierFind from \"./notifier/find\";\n\nimport type {AbsintheEvent} from \"./absinthe-event/types\";\nimport type {AbsintheSocket, NotifierPushHandler} from \"./types\";\n\nconst getPushHandlerMethodGetter = (absintheSocket, request) => handle => (\n  ...args\n) => {\n  const notifier = notifierFind(absintheSocket.notifiers, \"request\", request);\n\n  if (notifier) {\n    handle(absintheSocket, notifier, ...args);\n  }\n};\n\nconst getPushHandler = (absintheSocket, request, notifierPushHandler) =>\n  map(getPushHandlerMethodGetter(absintheSocket, request), notifierPushHandler);\n\nconst pushAbsintheEvent = <Variables: void | Object, Response: Object>(\n  absintheSocket: AbsintheSocket,\n  request: GqlRequest<Variables>,\n  notifierPushHandler: NotifierPushHandler<Response>,\n  absintheEvent: AbsintheEvent\n) => {\n  handlePush(\n    absintheSocket.channel.push(absintheEvent.name, absintheEvent.payload),\n    getPushHandler(absintheSocket, request, notifierPushHandler)\n  );\n\n  return absintheSocket;\n};\n\nexport default pushAbsintheEvent;\n","// @flow\n\nimport {replace as arrayReplace} from \"@jumpn/utils-array\";\n\nimport findIndex from \"./findIndex\";\n\nimport type {Notifier} from \"./types\";\n\nconst refresh = (notifier: Notifier<any, any>) => (\n  notifiers: Array<Notifier<any, any>>\n) =>\n  arrayReplace(\n    findIndex(notifiers, \"request\", notifier.request),\n    [notifier],\n    notifiers\n  );\n\nexport default refresh;\n","// @flow\n\nimport notifierRefresh from \"./notifier/refresh\";\nimport updateNotifiers from \"./updateNotifiers\";\n\nimport type {AbsintheSocket} from \"./types\";\nimport type {Notifier} from \"./notifier/types\";\n\nconst refreshNotifier = <Result, Variables: void | Object>(\n  absintheSocket: AbsintheSocket,\n  notifier: Notifier<Result, Variables>\n) => {\n  updateNotifiers(absintheSocket, notifierRefresh(notifier));\n\n  return notifier;\n};\n\nexport default refreshNotifier;\n","// @flow\n\nconst requestStatuses = {\n  canceled: (\"canceled\": \"canceled\"),\n  canceling: (\"canceling\": \"canceling\"),\n  pending: (\"pending\": \"pending\"),\n  sent: (\"sent\": \"sent\"),\n  sending: (\"sending\": \"sending\")\n};\n\ntype RequestStatus = $Values<typeof requestStatuses>;\n\nexport default requestStatuses;\n\nexport type {RequestStatus};\n","// @flow\n\nconst absintheEventNames = {\n  doc: (\"doc\": \"doc\"),\n  unsubscribe: (\"unsubscribe\": \"unsubscribe\")\n};\n\ntype AbsintheEventName = $Values<typeof absintheEventNames>;\n\nexport default absintheEventNames;\n\nexport type {AbsintheEventName};\n","// @flow\n\nimport absintheEventNames from \"./absintheEventNames\";\n\nimport type {AbsintheDocEvent, AbsintheUnsubscribeEvent} from \"./types\";\n\nconst createAbsintheUnsubscribeEvent = (\n  payload: $ElementType<AbsintheUnsubscribeEvent, \"payload\">\n): AbsintheUnsubscribeEvent => ({\n  payload,\n  name: absintheEventNames.unsubscribe\n});\n\nconst createAbsintheDocEvent = <Variables: void | Object>(\n  payload: $ElementType<AbsintheDocEvent<Variables>, \"payload\">\n): AbsintheDocEvent<Variables> => ({\n  payload,\n  name: absintheEventNames.doc\n});\n\nexport {createAbsintheDocEvent, createAbsintheUnsubscribeEvent};\n","// @flow\n\nimport {requestToCompat} from \"@jumpn/utils-graphql\";\n\nimport abortNotifier from \"./abortNotifier\";\nimport notifierNotifyActive from \"./notifier/notifyActive\";\nimport pushAbsintheEvent from \"./pushAbsintheEvent\";\nimport refreshNotifier from \"./refreshNotifier\";\nimport requestStatuses from \"./notifier/requestStatuses\";\nimport {createAbsintheDocEvent} from \"./absinthe-event/absintheEventCreators\";\nimport {createErrorEvent} from \"./notifier/event/eventCreators\";\n\nimport type {AbsintheSocket, NotifierPushHandler} from \"./types\";\nimport type {Notifier} from \"./notifier/types\";\n\nconst pushAbsintheDocEvent = (absintheSocket, {request}, notifierPushHandler) =>\n  pushAbsintheEvent(\n    absintheSocket,\n    request,\n    notifierPushHandler,\n    createAbsintheDocEvent(requestToCompat(request))\n  );\n\nconst setNotifierRequestStatusSending = (absintheSocket, notifier) =>\n  refreshNotifier(absintheSocket, {\n    ...notifier,\n    requestStatus: requestStatuses.sending\n  });\n\nconst createRequestError = message => new Error(`request: ${message}`);\n\nconst onTimeout = (absintheSocket, notifier) =>\n  notifierNotifyActive(\n    notifier,\n    createErrorEvent(createRequestError(\"timeout\"))\n  );\n\nconst onError = (\n  absintheSocket: AbsintheSocket,\n  notifier: Notifier<any, any>,\n  errorMessage: string\n) => abortNotifier(absintheSocket, notifier, createRequestError(errorMessage));\n\nconst getNotifierPushHandler = onSucceed => ({onError, onSucceed, onTimeout});\n\nconst pushRequestUsing = (\n  absintheSocket: AbsintheSocket,\n  notifier: Notifier<any, any>,\n  onSucceed: $ElementType<NotifierPushHandler<any>, \"onSucceed\">\n) =>\n  pushAbsintheDocEvent(\n    absintheSocket,\n    setNotifierRequestStatusSending(absintheSocket, notifier),\n    getNotifierPushHandler(onSucceed)\n  );\n\nexport {pushRequestUsing as default, onError};\n","// @flow\n\nimport observerNotifyAll from \"./observer/notifyAll\";\n\nimport type {Event, Notifier} from \"./types\";\n\nconst notifyCanceled = <Result, Variables: void | Object>(\n  notifier: Notifier<Result, Variables>,\n  event: Event\n) => {\n  observerNotifyAll(notifier.canceledObservers, event);\n\n  return notifier;\n};\n\nexport default notifyCanceled;\n","// @flow\n\nimport notifyCanceled from \"./notifyCanceled\";\nimport {createCancelEvent} from \"./event/eventCreators\";\n\nimport type {Notifier} from \"./types\";\n\nconst clearCanceled = notifier => ({\n  ...notifier,\n  canceledObservers: []\n});\n\nconst flushCanceled = <Result: any, Variables: void | Object>(\n  notifier: Notifier<Result, Variables>\n) =>\n  notifier.canceledObservers.length > 0\n    ? clearCanceled(notifyCanceled(notifier, createCancelEvent()))\n    : notifier;\n\nexport default flushCanceled;\n","// @flow\n\nimport flushCanceled from \"./flushCanceled\";\nimport requestStatuses from \"./requestStatuses\";\n\nimport type {Notifier} from \"./types\";\n\nconst reset = <Result, Variables: void | Object>(\n  notifier: Notifier<Result, Variables>\n) =>\n  flushCanceled({\n    ...notifier,\n    isActive: true,\n    requestStatus: requestStatuses.pending,\n    subscriptionId: undefined\n  });\n\nexport default reset;\n","// @flow\n\nimport {errorsToString as gqlErrorsToString} from \"@jumpn/utils-graphql\";\n\nimport type {\n  GqlError,\n  GqlResponse\n} from \"@jumpn/utils-graphql/compat/cjs/types\";\nimport type {Message} from \"phoenix\";\n\nimport abortNotifier from \"./abortNotifier\";\nimport notifierFind from \"./notifier/find\";\nimport notifierFlushCanceled from \"./notifier/flushCanceled\";\nimport notifierNotifyCanceled from \"./notifier/notifyCanceled\";\nimport notifierNotifyResultEvent from \"./notifier/notifyResultEvent\";\nimport notifierNotifyStartEvent from \"./notifier/notifyStartEvent\";\nimport notifierRemove from \"./notifier/remove\";\nimport notifierReset from \"./notifier/reset\";\nimport pushAbsintheEvent from \"./pushAbsintheEvent\";\nimport pushRequestUsing, {onError} from \"./pushRequestUsing\";\nimport refreshNotifier from \"./refreshNotifier\";\nimport requestStatuses from \"./notifier/requestStatuses\";\nimport updateNotifiers from \"./updateNotifiers\";\nimport {createAbsintheUnsubscribeEvent} from \"./absinthe-event/absintheEventCreators\";\nimport {createErrorEvent} from \"./notifier/event/eventCreators\";\n\nimport type {AbsintheSocket, NotifierPushHandler} from \"./types\";\nimport type {Notifier} from \"./notifier/types\";\n\ntype SubscriptionPayload<Data> = {|\n  result: GqlResponse<Data>,\n  subscriptionId: string\n|};\n\n// TODO: improve this type\ntype UnsubscribeResponse = {};\n\ntype SubscriptionResponse =\n  | {|subscriptionId: string|}\n  | {|errors: Array<GqlError>|};\n\nconst onUnsubscribeSucceedCanceled = (absintheSocket, notifier) =>\n  updateNotifiers(\n    absintheSocket,\n    notifierRemove(notifierFlushCanceled(notifier))\n  );\n\nconst onUnsubscribeSucceedActive = (absintheSocket, notifier) =>\n  subscribe(\n    absintheSocket,\n    refreshNotifier(absintheSocket, notifierReset(notifier))\n  );\n\nconst createUnsubscribeError = message => new Error(`unsubscribe: ${message}`);\n\nconst unsubscribeHandler: NotifierPushHandler<UnsubscribeResponse> = {\n  onError: (absintheSocket, notifier, errorMessage) =>\n    abortNotifier(\n      absintheSocket,\n      notifier,\n      createUnsubscribeError(errorMessage)\n    ),\n\n  onTimeout: (absintheSocket, notifier) =>\n    notifierNotifyCanceled(\n      notifier,\n      createErrorEvent(createUnsubscribeError(\"timeout\"))\n    ),\n\n  onSucceed: (absintheSocket, notifier) => {\n    if (notifier.isActive) {\n      onUnsubscribeSucceedActive(absintheSocket, notifier);\n    } else {\n      onUnsubscribeSucceedCanceled(absintheSocket, notifier);\n    }\n  }\n};\n\nconst pushAbsintheUnsubscribeEvent = (\n  absintheSocket,\n  {request, subscriptionId}\n) =>\n  pushAbsintheEvent(\n    absintheSocket,\n    request,\n    unsubscribeHandler,\n    createAbsintheUnsubscribeEvent({subscriptionId})\n  );\n\nconst unsubscribe = (\n  absintheSocket: AbsintheSocket,\n  notifier: Notifier<any, any>\n) =>\n  pushAbsintheUnsubscribeEvent(\n    absintheSocket,\n    refreshNotifier(absintheSocket, {\n      ...notifier,\n      requestStatus: requestStatuses.canceling\n    })\n  );\n\nconst onSubscribeSucceed = (absintheSocket, notifier, {subscriptionId}) => {\n  const subscribedNotifier = refreshNotifier(absintheSocket, {\n    ...notifier,\n    subscriptionId,\n    requestStatus: requestStatuses.sent\n  });\n\n  if (subscribedNotifier.isActive) {\n    notifierNotifyStartEvent(subscribedNotifier);\n  } else {\n    unsubscribe(absintheSocket, subscribedNotifier);\n  }\n};\n\nconst onSubscribe = (\n  absintheSocket: AbsintheSocket,\n  notifier: Notifier<any, any>,\n  response: SubscriptionResponse\n) => {\n  if (response.errors) {\n    onError(absintheSocket, notifier, gqlErrorsToString(response.errors));\n  } else {\n    onSubscribeSucceed(absintheSocket, notifier, response);\n  }\n};\n\nconst subscribe = <Result, Variables: void | Object>(\n  absintheSocket: AbsintheSocket,\n  notifier: Notifier<Result, Variables>\n) => pushRequestUsing(absintheSocket, notifier, onSubscribe);\n\nconst onDataMessage = (\n  absintheSocket: AbsintheSocket,\n  {payload}: Message<SubscriptionPayload<any>>\n) => {\n  const notifier = notifierFind(\n    absintheSocket.notifiers,\n    \"subscriptionId\",\n    payload.subscriptionId\n  );\n\n  if (notifier) {\n    notifierNotifyResultEvent(notifier, payload.result);\n  }\n};\n\nconst dataMessageEventName = \"subscription:data\";\n\nconst isDataMessage = (message: Message<>) =>\n  message.event === dataMessageEventName;\n\nexport {isDataMessage, onDataMessage, subscribe, unsubscribe};\n\nexport type {SubscriptionPayload};\n","// @flow\n\nimport type {GqlResponse} from \"@jumpn/utils-graphql/compat/cjs/types\";\n\nimport notifierNotifyResultEvent from \"./notifier/notifyResultEvent\";\nimport notifierNotifyStartEvent from \"./notifier/notifyStartEvent\";\nimport notifierRemove from \"./notifier/remove\";\nimport pushRequestUsing from \"./pushRequestUsing\";\nimport refreshNotifier from \"./refreshNotifier\";\nimport requestStatuses from \"./notifier/requestStatuses\";\nimport updateNotifiers from \"./updateNotifiers\";\nimport {subscribe} from \"./subscription\";\n\nimport type {AbsintheSocket} from \"./types\";\nimport type {Notifier} from \"./notifier/types\";\n\nconst setNotifierRequestStatusSent = (absintheSocket, notifier) =>\n  refreshNotifier(absintheSocket, {\n    ...notifier,\n    requestStatus: requestStatuses.sent\n  });\n\nconst onQueryOrMutationSucceed = (\n  absintheSocket: AbsintheSocket,\n  notifier: Notifier<any, any>,\n  response: GqlResponse<any>\n) =>\n  updateNotifiers(\n    absintheSocket,\n    notifierRemove(\n      notifierNotifyResultEvent(\n        setNotifierRequestStatusSent(absintheSocket, notifier),\n        response\n      )\n    )\n  );\n\nconst pushQueryOrMutation = (absintheSocket, notifier) =>\n  pushRequestUsing(\n    absintheSocket,\n    notifierNotifyStartEvent(notifier),\n    onQueryOrMutationSucceed\n  );\n\nconst pushRequest = (\n  absintheSocket: AbsintheSocket,\n  notifier: Notifier<any, any>\n) => {\n  if (notifier.operationType === \"subscription\") {\n    subscribe(absintheSocket, notifier);\n  } else {\n    pushQueryOrMutation(absintheSocket, notifier);\n  }\n};\n\nexport default pushRequest;\n","// @flow\n\nimport handlePush from \"./handlePush\";\nimport notifierNotifyActive from \"./notifier/notifyActive\";\nimport pushRequest from \"./pushRequest\";\nimport {createErrorEvent} from \"./notifier/event/eventCreators\";\n\nimport type {AbsintheSocket} from \"./types\";\n\nconst createChannelJoinError = message => new Error(`channel join: ${message}`);\n\nconst notifyErrorToAllActive = (absintheSocket, errorMessage) =>\n  absintheSocket.notifiers.forEach(notifier =>\n    notifierNotifyActive(\n      notifier,\n      createErrorEvent(createChannelJoinError(errorMessage))\n    )\n  );\n\n// join Push is reused and so the handler\n// https://github.com/phoenixframework/phoenix/blob/master/assets/js/phoenix.js#L356\nconst createChannelJoinHandler = absintheSocket => ({\n  onError: (errorMessage: string) =>\n    notifyErrorToAllActive(absintheSocket, errorMessage),\n\n  onSucceed: () =>\n    absintheSocket.notifiers.forEach(notifier =>\n      pushRequest(absintheSocket, notifier)\n    ),\n\n  onTimeout: () => notifyErrorToAllActive(absintheSocket, \"timeout\")\n});\n\nconst joinChannel = (absintheSocket: AbsintheSocket) => {\n  handlePush(\n    absintheSocket.channel.join(),\n    createChannelJoinHandler(absintheSocket)\n  );\n\n  absintheSocket.channelJoinCreated = true;\n\n  return absintheSocket;\n};\n\nexport default joinChannel;\n","// @flow\n\nimport {Socket as PhoenixSocket} from \"phoenix\";\n\nimport type {Message} from \"phoenix\";\n\nimport abortNotifier from \"./abortNotifier\";\nimport joinChannel from \"./joinChannel\";\nimport notifierNotify from \"./notifier/notify\";\nimport notifierRemove from \"./notifier/remove\";\nimport notifierReset from \"./notifier/reset\";\nimport refreshNotifier from \"./refreshNotifier\";\nimport updateNotifiers from \"./updateNotifiers\";\nimport * as withSubscription from \"./subscription\";\nimport {createErrorEvent} from \"./notifier/event/eventCreators\";\n\nimport type {AbsintheSocket} from \"./types\";\n\nconst onMessage = absintheSocket => (message: Message<>) => {\n  if (withSubscription.isDataMessage(message)) {\n    withSubscription.onDataMessage(absintheSocket, message);\n  }\n};\n\nconst createConnectionCloseError = () => new Error(\"connection: close\");\n\nconst notifyConnectionCloseError = notifier =>\n  notifierNotify(notifier, createErrorEvent(createConnectionCloseError()));\n\nconst notifierOnConnectionCloseCanceled = (absintheSocket, notifier) =>\n  updateNotifiers(\n    absintheSocket,\n    notifierRemove(notifyConnectionCloseError(notifier))\n  );\n\nconst notifierOnConnectionCloseActive = (absintheSocket, notifier) => {\n  if (notifier.operationType === \"mutation\") {\n    abortNotifier(absintheSocket, notifier, createConnectionCloseError());\n  } else {\n    refreshNotifier(\n      absintheSocket,\n      notifierReset(notifyConnectionCloseError(notifier))\n    );\n  }\n};\n\nconst notifierOnConnectionClose = absintheSocket => notifier => {\n  if (notifier.isActive) {\n    notifierOnConnectionCloseActive(absintheSocket, notifier);\n  } else {\n    notifierOnConnectionCloseCanceled(absintheSocket, notifier);\n  }\n};\n\nconst onConnectionClose = absintheSocket => () =>\n  absintheSocket.notifiers.forEach(notifierOnConnectionClose(absintheSocket));\n\nconst shouldJoinChannel = absintheSocket =>\n  !absintheSocket.channelJoinCreated && absintheSocket.notifiers.length > 0;\n\nconst onConnectionOpen = absintheSocket => () => {\n  if (shouldJoinChannel(absintheSocket)) {\n    joinChannel(absintheSocket);\n  }\n};\n\nconst absintheChannelName = \"__absinthe__:control\";\n\n/**\n * Creates an Absinthe Socket using the given Phoenix Socket instance\n *\n * @example\n * import * as withAbsintheSocket from \"@absinthe/socket\";\n * import {Socket as PhoenixSocket} from \"phoenix\";\n\n * const absintheSocket = withAbsintheSocket.create(\n *   new PhoenixSocket(\"ws://localhost:4000/socket\")\n * );\n */\nconst create = (phoenixSocket: PhoenixSocket): AbsintheSocket => {\n  const absintheSocket: AbsintheSocket = {\n    phoenixSocket,\n    channel: phoenixSocket.channel(absintheChannelName),\n    channelJoinCreated: false,\n    notifiers: []\n  };\n\n  phoenixSocket.onOpen(onConnectionOpen(absintheSocket));\n  phoenixSocket.onClose(onConnectionClose(absintheSocket));\n  phoenixSocket.onMessage(onMessage(absintheSocket));\n\n  return absintheSocket;\n};\n\nexport default create;\n"],"names":["getNotifier","handlerName","payload","observer","getHandlerName","name","notifyAll","observers","event","forEach","getObservers","activeObservers","canceledObservers","notify","notifier","observerNotifyAll","findIndex","notifiers","key","value","hasIn","remove","arrayRemove","request","updateNotifiers","absintheSocket","updater","eventNames","abort","cancel","error","result","start","createStartEvent","createResultEvent","createErrorEvent","createCancelEvent","undefined","createAbortEvent","abortNotifier","notifierRemove","notifierNotify","handlePush","push","handler","receive","onSucceed","onError","onTimeout","notifyActive","notifyResultEvent","notifyStartEvent","find","getPushHandlerMethodGetter","handle","notifierFind","args","getPushHandler","notifierPushHandler","map","pushAbsintheEvent","absintheEvent","channel","refresh","arrayReplace","refreshNotifier","notifierRefresh","requestStatuses","canceled","canceling","pending","sent","sending","absintheEventNames","doc","unsubscribe","createAbsintheUnsubscribeEvent","createAbsintheDocEvent","pushAbsintheDocEvent","requestToCompat","setNotifierRequestStatusSending","requestStatus","createRequestError","message","Error","notifierNotifyActive","errorMessage","getNotifierPushHandler","pushRequestUsing","notifyCanceled","clearCanceled","flushCanceled","length","reset","isActive","subscriptionId","onUnsubscribeSucceedCanceled","notifierFlushCanceled","onUnsubscribeSucceedActive","subscribe","notifierReset","createUnsubscribeError","unsubscribeHandler","notifierNotifyCanceled","pushAbsintheUnsubscribeEvent","onSubscribeSucceed","subscribedNotifier","notifierNotifyStartEvent","onSubscribe","response","errors","gqlErrorsToString","onDataMessage","notifierNotifyResultEvent","dataMessageEventName","isDataMessage","setNotifierRequestStatusSent","onQueryOrMutationSucceed","pushQueryOrMutation","pushRequest","operationType","createChannelJoinError","notifyErrorToAllActive","createChannelJoinHandler","joinChannel","join","channelJoinCreated","onMessage","withSubscription","createConnectionCloseError","notifyConnectionCloseError","notifierOnConnectionCloseCanceled","notifierOnConnectionCloseActive","notifierOnConnectionClose","onConnectionClose","shouldJoinChannel","onConnectionOpen","absintheChannelName","create","phoenixSocket","onOpen","onClose"],"mappings":"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"}